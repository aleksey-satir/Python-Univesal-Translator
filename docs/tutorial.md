 This tutorial describes how create of python to js transpiler that can translate following code:

```python
def fib(n):
    nums = [1, 1]
    for i in range(2, n):
        nums.append(nums[i - 2] + nums[i - 1])
    return nums

import random
print(fib(random.randint(1, 200)))
```

## Install **Kithon**

The first step is to install **Kithon**.

<div class="termy">

```console
$ pip install kithon

---> 100%
```
</div>

## Create language template

JavaScript have c-like syntax, then we can use following command to create template of our transpiler

```
kithon new --base=C JS
```

Now we have dirrectory JS with the folowing content:

```
JS
├── core.tp
├── macros.tp
├── libs/
└── objects/
```

Some template, such as functions or for loop, are already in `core.tp` and if compile our program we get this code:

```js
function fib(n) {
    nums = [1, 1];
    for (i = 2;i < n; i += 1) {
        nums.append(nums[i - 2] + nums[i - 1]);
    }
    return nums;
}
import random
print(fib(random.randint(1, 200)));
```

## JavaScript-specifc constructions

Now we need to add JavaScript-specific constructs, for example, using the keyword `let` in defining new variables.

```yaml
new_var: "let {{var}} = {{value}}"
```

Now our code compile to this:

```js
function fib(n) {
    let nums = [1, 1];
    for (i = 2;i < n; i += 1) {
        nums.append(nums[i - 2] + nums[i - 1]);
    }
    return nums;
}
import random
print(fib(random.randint(1, 200)));
```

## Macros

Next step is to add macros. We need replace `print` to `console.log`, write this code in macros.tp: 

```yaml
print:
  alt_name: "console.log"
```
<br>
List method `append` in python changed by `push` method in js. Create list.tp file in objects dirrectory and write this code:

```yaml
list[any]:
  append:
	alt_name: "push"
```
<br>

A `random` module in js doesn't need to be imported. The function `random(min, max)` from the random module can be changed using this code: 

```js
(Math.floor(Math.random() * (max - min)) + min)
```

Then write next code to `JS/libs/random.tp`:
```yaml
random:
  import_code: no

  randint:
    code: "(Math.floor(Math.random() * ({{args[1]}} - {{args[0]}})) + {{args[0]}})"
```

After these steps, our code transpiled to this:

```js
function fib(n) {
    let nums = [1, 1];
    for (i = 2;i < n; i += 1) {
        nums.push(nums[i - 2] + nums[i - 1]);
    }
    return nums;
}

console.log(fib((Math.floor(Math.random() * (200 - 1)) + 1)));
```


## Tools

Last step in creating transpiler is provide dev-tools. We need to run our code in nodejs and use its repl.

To run code in nodejs we can use this command template `node -e '{{code}}'`, code is generated by kithon and placed to template

For provide repl we need in command to run repl and prompt to type, then see what happend when we start nodejs:

<div class="termy">

```console
$ node
Welcome to Node.js v17.2.0.
Type ".help" for more information.
> console.log(
```
</div>


So we can create file `JS/tools.tp` and write this code:

```yaml
meta:
  repl:
    name: "node"
    prompt: "> "
  run: "node -e '{{code}}'"
```

In the end create file main.py with code form start of tutorial and try execute these commands:

<div class="termy">

```console
$ kithon gen --to JS main.py
function fib(n) {
    let nums = [1, 1];
    for (i = 2;i < n; i += 1) {
        nums.push(nums[i - 2] + nums[i - 1]);
    }
    return nums;
}

console.log(fib((Math.floor(Math.random() * (200 - 1)) + 1)));
$ kithon run --to JS main.py
[
	  <font color="lightgreen">1</font>,  <font color="lightgreen">1</font>,  <font color="lightgreen">2</font>,  <font color="lightgreen">3</font>,  <font color="lightgreen">5</font>,   <font color="lightgreen">8</font>,
	 <font color="lightgreen">13</font>, <font color="lightgreen">21</font>, <font color="lightgreen">34</font>, <font color="lightgreen">55</font>, <font color="lightgreen">89</font>, <font color="lightgreen">144</font>,
	<font color="lightgreen">233</font>
]
```
</div>
